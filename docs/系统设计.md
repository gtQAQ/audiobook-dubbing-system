# 系统设计

## 1.1系统总体设计

为了更好的梳理本系统的总体思路，进而产生一个可用的解决方案，便于将设计方案转换成程序代码。本设计实现的有声读物配音系统的总体结构图如图1.1所示。


![](D:\Users\wuyuxiang\Desktop\test\docs\image\1.jpg)

图1.1 系统总体结构图

该系统分为管理员和用户两种角色，此二者的核心功能结构图如图1.2所示。


![](D:\Users\wuyuxiang\Desktop\test\docs\image\2.jpg)

图1.2核心功能结构图

## 1.2登录功能设计

使用本系统首先需要进行登录操作，用户与管理员需要账号密码才能登录，登录流程图如图3.3所示。


![](D:\Users\wuyuxiang\Desktop\test\docs\image\3.jpg)

图1.3 登录功能流程图

## 1.3个人中心功能设计

本系统的个人中心用于展示个人资料，个人资料包括用户昵称、手机号码、邮箱、性别、所属角色，提供资料修改和密码修改功能。



### 1.3.1资料修改功能设计

用户或管理员需要输入修改的信息（用户昵称、手机号码、邮箱、性别），后端对手机号码的合法性进行校验，校验成功后更新数据库中信息，并返回修改成功。修改资料的业务流程如图1.4资料修改功能流程图所示。


![](D:\Users\wuyuxiang\Desktop\test\docs\image\4.jpg)

图1.4 资料修改功能流程



### 1.3.2密码修改功能设计

用户或管理员需要输入旧密码、新密码、确认新密码，后端会对新密码合法性进行校验且在进行加密后和数据库中的数据进行对比，成功后更新数据库中信息，然后跳转到登录页面重新登录。修改密码的业务流程如图1.5修改密码功能流程图所示。


![](D:\Users\wuyuxiang\Desktop\test\test\docs\image\5.jpg)

图1.5密码修改功能流程图



## 1.4文本上传功能设计

用户或管理员需要选择本地文件进行上传，页面会校验文件格式的合法性（只允许上传txt格式的文件、限制大小10M)，成功上传后需要点击开始解析按钮，解析成功后可在下方文本框中可展示文件文本内容。另提供一键复制按钮，供用户或管理员复制文件文本内容到剪贴板。文本上传的业务流程如图1.6文件上传功能流程图所示。


![](D:\Users\wuyuxiang\Desktop\test\docs\image\6.jpg)

图1.6 文本上传功能流程图



## 1.5音频合成功能设计

用户或管理员需要在文本框中输入或粘贴小说文本，然后选择情感类型，点击合成音频。合成音频成功后可对音频进行试听，用户或管理员在试听效果满意后可进行保存，成功则更新数据库中信息并返回保存成功。音频合成的业务流程如图1.7音频合成功能流程图所示。


![](D:\Users\wuyuxiang\Desktop\test\docs\image\7.jpg)

图1.7音频合成功能流程图



## 1.6文件下载功能设计

文件下载设计表如表1.1所示，展示音频合成模块中保存下来的音频，（序号、情感类型、时间），用户或管理员可在表单中对保存下来的音频进行试听、下载、删除操作。

表1.1文件下载设计表

<table border="1" ><tr>
<td>序号</td>
<td>情感类型</td>
<td>时间</td>
<td>操作</td>
</tr><tr>
<td>按合成时间升序排列</td>
<td>喜／怒／哀／惧</td>
<td>显示音频合成时间</td>
<td>试听、下载、删除</td>
</tr></table>

## 3.7用户管理功能设计

用户管理设计表如表1.2所示，展示所有账号的用户昵称、手机号码、邮箱、性别。支持通过账号和手机号码进行查询，支持新增以添加账号。管理员可在表单中对这些个人信息进行修改、删除以及重置密码操作。

表1.2 用户管理设计表

<table border="1" ><tr>
<td>账号</td>
<td>用户昵称</td>
<td>手机号码</td>
<td>邮箱</td>
<td>性别</td>
<td>操作</td>
</tr><tr>
<td>登录账号</td>
<td>个人资料</td>
<td>个人资料</td>
<td>个人资料</td>
<td>男／女</td>
<td>修改、删除、重置密码</td>
</tr></table>

## 3.8数据库设计

本设计使用以下音频管理表以满足系统的音频管理需求，音频管理表如表1.3所示。

表1.3音频管理表

<table border="1" ><tr>
<td>字段名</td>
<td>描述</td>
<td>长度</td>
<td>类型</td>
<td>允许空值</td>
<td>主键</td>
<td>备注</td>
</tr><tr>
<td>id </td>
<td>自增ID </td>
<td>11 </td>
<td>int </td>
<td>否</td>
<td>是</td>
<td>自动递增</td>
</tr><tr>
<td>user_id</td>
<td>用户ID </td>
<td>255 </td>
<td>int </td>
<td>否</td>
<td>否</td>
<td></td>
</tr><tr>
<td>audio_path</td>
<td>音频路径</td>
<td></td>
<td>text </td>
<td>否</td>
<td>否</td>
<td></td>
</tr><tr>
<td>emo_type</td>
<td>情感类型</td>
<td>255 </td>
<td>int </td>
<td>是</td>
<td>否</td>
<td>默认为0 </td>
</tr><tr>
<td></td>
<td>0：喜，1：怒，<br>2：哀，3：惧。</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr><tr>
<td>create_time</td>
<td>创建时间</td>
<td></td>
<td>datetime </td>
<td>是</td>
<td>否</td>
<td>自动生成</td>
</tr><tr>
<td>update_time</td>
<td>更新时间</td>
<td></td>
<td>datetime </td>
<td>是</td>
<td>否</td>
<td>自动更新</td>
</tr></table>


## 3.9API调用

本设计API调用参考下图，参数选择：emo_control_method_idx="与音色参考音频相同"。参考音频在voice文件夹下，喜，怒，哀，惧四个参考音频对应本设计中喜怒哀惧四种音色，TTS模型端口在http://localhost:7860/开启。

![](D:\Users\wuyuxiang\Desktop\test\docs\image\8.png)